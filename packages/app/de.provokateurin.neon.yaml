app-id: de.provokateurin.neon
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: nextcloud-neon
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --share=network
  - --device=dri
modules:
  - ../../external/flathub-shared-modules/libappindicator/libappindicator-gtk3-12.10.json
  - name: nextcloud-neon
    buildsystem: simple
    build-commands:
      - mkdir -p /app/nextcloud-neon/{data,lib}
      - cp nextcloud-neon /app/nextcloud-neon/
      - cp *.so /app/nextcloud-neon/lib/
      - cp -r flutter_assets icudtl.dat /app/nextcloud-neon/data/
      - ln -s /usr/lib/x86_64-linux-gnu/libsqlite3.so.0 /app/lib/libsqlite3.so
      - if [ ! -e '/app/lib/libsqlite3.so' ]; then ln -s -f /usr/lib/aarch64-linux-gnu/libsqlite3.so.0 /app/lib/libsqlite3.so; fi
      - ln -sf /app/nextcloud-neon/nextcloud-neon /app/bin/nextcloud-neon
    sources:
      - type: file
        path: build/linux/x64/release/bundle/nextcloud-neon
      - type: dir
        path: build/linux/x64/release/bundle/lib/
      - type: dir
        path: build/linux/x64/release/bundle/data/
